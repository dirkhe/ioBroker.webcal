{
  "version": 3,
  "sources": ["../../src/lib/eventManager.ts"],
  "sourcesContent": ["import { AdapterInstance } from \"@iobroker/adapter-core\";\nimport dayjs from \"dayjs\";\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport RegExpEscape from \"regex-escape\";\nimport { jsonEvent } from \"./calendarManager\";\n\nlet adapter: AdapterInstance;\nlet i18n: Record<string, string> = {};\n\nexport class Event {\n\tstatic namespace = \"events.\";\n\tstatic daysFuture = 3;\n\tstatic daysPast = 0;\n\tid: string;\n\tname: string;\n\tregEx: RegExp;\n\tdefaultCalendar?: string;\n\tuseIQontrol: boolean;\n\tstateValues: Record<number, Array<jsonEvent>> = {};\n\tnowFlag: {\n\t\ttimes: Array<webcal.IEventTimeRangObj>;\n\t\ttimerID: NodeJS.Timeout | null;\n\t\tallDay: boolean;\n\t} | null = null;\n\n\tconstructor(config: webcal.IConfigEvent) {\n\t\tthis.name = config.name;\n\t\tthis.id = this.name.replace(/[^a-z0-9_-]/gi, \"\");\n\t\tthis.regEx = new RegExp(config.regEx || RegExpEscape(config.name), \"i\");\n\t\tthis.defaultCalendar = config.defaultCalendar;\n\t\tthis.useIQontrol = !!config.useIQontrol;\n\t}\n\n\tcheckCalendarContent(content: string): boolean {\n\t\treturn this.regEx.test(content) || content.indexOf(this.name) >= 0;\n\t}\n\n\taddCalendarEvent(days: Record<number, jsonEvent>): void {\n\t\tlet values;\n\t\tfor (const d in days) {\n\t\t\tconst day: number = d as unknown as number;\n\t\t\t//if (day >= -Event.daysPast && day <= Event.daysFuture) {\n\t\t\tvalues = this.stateValues[day];\n\t\t\tif (!values) {\n\t\t\t\tvalues = this.stateValues[day] = [];\n\t\t\t}\n\t\t\tvalues.push(days[day]);\n\t\t\t//}\n\t\t}\n\t\tadapter.log.debug(\"days for event \" + this.name + \": \" + JSON.stringify(this.stateValues));\n\t\tconst today = days[0];\n\t\tif (today) {\n\t\t\t// we have a hit today\n\t\t\tif (this.nowFlag && today.startTime) {\n\t\t\t\tif (!this.nowFlag.allDay) {\n\t\t\t\t\tlet curTime = null;\n\t\t\t\t\tfor (let i = 0; curTime == null && i < this.nowFlag.times.length; i++) {\n\t\t\t\t\t\tcurTime = this.nowFlag.times[i];\n\t\t\t\t\t\tif (today.startTime < curTime.start) {\n\t\t\t\t\t\t\tif (today.endTime && curTime.start > today.endTime) {\n\t\t\t\t\t\t\t\t// hole timeframe is befor cur timeframe, so we insert it as new item\n\t\t\t\t\t\t\t\tthis.nowFlag.times.splice(i, 0, {\n\t\t\t\t\t\t\t\t\tstart: today.startTime,\n\t\t\t\t\t\t\t\t\tend: today.endTime,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// we will start earlier\n\t\t\t\t\t\t\t\tcurTime.start = today.startTime;\n\t\t\t\t\t\t\t\tif (today.endTime && today.endTime > curTime.end) {\n\t\t\t\t\t\t\t\t\t// the endtime is later then cur timeframe, so we stopps later\n\t\t\t\t\t\t\t\t\tcurTime.end = today.endTime;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (today.startTime == curTime.start || today.startTime < curTime.end) {\n\t\t\t\t\t\t\tif (today.endTime && today.endTime > curTime.end) {\n\t\t\t\t\t\t\t\t// the endtime is later then cur timeframe, so we stopps later\n\t\t\t\t\t\t\t\tcurTime.end = today.endTime;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcurTime = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (curTime == null) {\n\t\t\t\t\t\tthis.nowFlag.times.push({\n\t\t\t\t\t\t\tstart: today.startTime,\n\t\t\t\t\t\t\tend: today.endTime,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// first entry\n\t\t\t\tthis.nowFlag = {\n\t\t\t\t\ttimes: [],\n\t\t\t\t\ttimerID: null,\n\t\t\t\t\tallDay: today.isAllday(),\n\t\t\t\t};\n\t\t\t\tif (!this.nowFlag.allDay) {\n\t\t\t\t\tthis.nowFlag.times.push({ start: today.startTime, end: today.endTime });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treset(): void {\n\t\tthis.stateValues = {};\n\t\tif (this.nowFlag && this.nowFlag.timerID) {\n\t\t\tclearTimeout(this.nowFlag.timerID);\n\t\t}\n\t\tthis.nowFlag = null;\n\t}\n\n\tsyncFlags(): void {\n\t\tadapter.getStatesAsync(Event.namespace + this.id + \".*\").then((states) => {\n\t\t\tif (states) {\n\t\t\t\tfor (const stateId in states) {\n\t\t\t\t\tconst evID = parseInt(stateId.split(\".\").pop() || \"0\", 10);\n\t\t\t\t\tif (!isNaN(evID)) {\n\t\t\t\t\t\t// its a number, so it will be a day state\n\t\t\t\t\t\tadapter.setStateChangedAsync(stateId, (this.stateValues[evID] || []).join(\", \"), true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tconst jsonData = [];\n\t\tlet next = new Date(\"9999-12-31\");\n\t\tconst now = new Date();\n\t\tfor (const d in this.stateValues) {\n\t\t\tconst dInt = parseInt(d, 10);\n\t\t\tconst dateText =\n\t\t\t\tdInt < -1\n\t\t\t\t\t? i18n.xDaysAgo.replace(\"%d\", Math.abs(dInt).toString())\n\t\t\t\t\t: dInt == -1\n\t\t\t\t\t? i18n.yesterday\n\t\t\t\t\t: dInt == 0\n\t\t\t\t\t? i18n.today\n\t\t\t\t\t: dInt == 1\n\t\t\t\t\t? i18n.Tomorrow\n\t\t\t\t\t: dInt > 1\n\t\t\t\t\t? i18n.inXDays.replace(\"%d\", d)\n\t\t\t\t\t: \"\";\n\t\t\tconst times = this.stateValues[d];\n\t\t\tfor (const i in times) {\n\t\t\t\tconst time = {\n\t\t\t\t\t...times[i],\n\t\t\t\t\ttimeText: times[i].toString(),\n\t\t\t\t\tdateText,\n\t\t\t\t};\n\t\t\t\tjsonData.push(time);\n\t\t\t\tif (time.date > now && time.date < next) {\n\t\t\t\t\tnext = time.date;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tadapter.setStateChangedAsync(Event.namespace + this.id + \".data\", JSON.stringify(jsonData), true);\n\t\tadapter.setStateChangedAsync(\n\t\t\tEvent.namespace + this.id + \".next\",\n\t\t\tnext.getFullYear() < 9999 ? next.toISOString() : \"\",\n\t\t\ttrue,\n\t\t);\n\t\tthis.updateNowFlag();\n\t}\n\n\tupdateNowFlag(): void {\n\t\tlet stateText = \"\";\n\t\tif (this.nowFlag) {\n\t\t\tif (this.nowFlag.timerID != null) {\n\t\t\t\tclearTimeout(this.nowFlag.timerID);\n\t\t\t\tthis.nowFlag.timerID = null;\n\t\t\t}\n\t\t\tif (this.nowFlag.allDay) {\n\t\t\t\tstateText = i18n.allDay;\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < this.nowFlag.times.length; i++) {\n\t\t\t\t\tconst todayStr = dayjs().format(\"YYYY-MM-DDT\");\n\t\t\t\t\tconst timeUntilStart = dayjs(todayStr + this.nowFlag.times[i].start).diff();\n\t\t\t\t\tconst timerUntilStop = dayjs(todayStr + this.nowFlag.times[i].end).diff();\n\t\t\t\t\tif (timeUntilStart <= 0 && timerUntilStop > 0) {\n\t\t\t\t\t\t// starttime is in the past and endTime is in the future\n\t\t\t\t\t\tstateText = this.nowFlag.times[i].start;\n\t\t\t\t\t\tthis.nowFlag.timerID = setTimeout(\n\t\t\t\t\t\t\tfunction (event) {\n\t\t\t\t\t\t\t\tevent.updateNowFlag();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttimerUntilStop,\n\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (timeUntilStart > 0) {\n\t\t\t\t\t\t\t// starttime is in the future\n\t\t\t\t\t\t\tthis.nowFlag.timerID = setTimeout(\n\t\t\t\t\t\t\t\tfunction (event) {\n\t\t\t\t\t\t\t\t\tevent.updateNowFlag();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttimeUntilStart,\n\t\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tadapter.setStateChangedAsync(Event.namespace + this.id + \".now\", stateText, true);\n\t}\n}\n\nexport class EventManager {\n\tevents: Record<string, Event>;\n\tiQontrolTimerID?: NodeJS.Timeout;\n\n\tconstructor(adapterInstance: AdapterInstance, i18nInstance: any) {\n\t\tadapter = adapterInstance;\n\t\ti18n = i18nInstance;\n\t\tthis.events = {};\n\t\tEvent.namespace = adapter.namespace + \".\" + Event.namespace;\n\t}\n\n\tinit(config: ioBroker.AdapterConfig): void {\n\t\tadapter.log.info(\"init events\");\n\t\tEvent.daysFuture = config.daysEventFuture;\n\t\tEvent.daysPast = config.daysEventPast;\n\t\t// init all Events\n\t\tfor (let i = 0; i < config.events.length; i++) {\n\t\t\tconst event = new Event(config.events[i]);\n\t\t\tthis.events[event.id] = event;\n\t\t}\n\t\tthis.syncEventStateObjects();\n\t}\n\n\t/**\n\t * create/update/delete all Event State objects based on config\n\t */\n\tsyncEventStateObjects(): void {\n\t\tconst allEventIDs: Record<string, boolean> = {};\n\t\tfor (const evID in this.events) {\n\t\t\tallEventIDs[evID] = true;\n\t\t}\n\n\t\tconst eventFlags: Record<string, string> = {\n\t\t\tnow: i18n[\"now\"],\n\t\t\taddEvent: i18n.addEvent,\n\t\t\tnext: i18n.nextEvent,\n\t\t\tdata: \"data\",\n\t\t\t\"0\": i18n[\"today\"],\n\t\t};\n\t\tfor (let d = 1; d <= Event.daysPast; d++) {\n\t\t\teventFlags[-d] = i18n[\"today\"] + \" - \" + d + \" \" + (d == 1 ? i18n[\"day\"] : i18n[\"days\"]);\n\t\t}\n\t\tfor (let d = 1; d <= Event.daysFuture; d++) {\n\t\t\teventFlags[d] = i18n[\"today\"] + \" + \" + d + \" \" + (d == 1 ? i18n[\"day\"] : i18n[\"days\"]);\n\t\t}\n\n\t\tadapter.getChannelsOf(\"events\", (_err, eventObjs) => {\n\t\t\tif (eventObjs) {\n\t\t\t\tfor (let e = 0; e < eventObjs?.length; e++) {\n\t\t\t\t\tconst eventObj = eventObjs[e];\n\t\t\t\t\tconst evID: string = eventObj._id.split(\".\").pop() || \"\";\n\t\t\t\t\tif (this.events[evID]) {\n\t\t\t\t\t\tdelete allEventIDs[evID];\n\t\t\t\t\t\tadapter.getStatesAsync(eventObj._id + \".*\").then((states) => {\n\t\t\t\t\t\t\tif (states) {\n\t\t\t\t\t\t\t\tfor (const stateId in states) {\n\t\t\t\t\t\t\t\t\tif (!eventFlags[stateId.split(\".\").pop() || \"\"]) {\n\t\t\t\t\t\t\t\t\t\tadapter.log.info(\"delete flag \" + stateId);\n\t\t\t\t\t\t\t\t\t\t//this.delForeignObjectAsync(stateId);\n\t\t\t\t\t\t\t\t\t\tadapter.delObjectAsync(stateId);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfor (const id in eventFlags) {\n\t\t\t\t\t\t\tthis.addEventFlagObject(eventObj._id + \".\" + id, eventFlags[id]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tadapter.log.info(\"delete event state \" + eventObj._id);\n\t\t\t\t\t\t//this.delForeignObjectAsync(eventObj._id, { recursive: true });\n\t\t\t\t\t\tadapter.delObjectAsync(eventObj._id, { recursive: true });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const evID in allEventIDs) {\n\t\t\t\tadapter.log.info(\"create event \" + this.events[evID].name);\n\t\t\t\tadapter.createChannel(\"events\", evID, (_err, eventObj) => {\n\t\t\t\t\tif (eventObj) {\n\t\t\t\t\t\tadapter.extendObjectAsync(eventObj.id, {\n\t\t\t\t\t\t\tcommon: {\n\t\t\t\t\t\t\t\tname: this.events[evID].name,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfor (const id in eventFlags) {\n\t\t\t\t\t\t\tthis.addEventFlagObject(eventObj.id + \".\" + id, eventFlags[id]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tadapter.setTimeout(this.syncIQontrolStates.bind(this), 2000);\n\t}\n\taddEventFlagObject(id: string, name: string): void {\n\t\tconst obj: ioBroker.StateObject = {\n\t\t\ttype: \"state\",\n\t\t\tcommon: {\n\t\t\t\tname: name,\n\t\t\t\ttype: \"string\",\n\t\t\t\trole: \"text\",\n\t\t\t\tread: true,\n\t\t\t\twrite: false,\n\t\t\t\tdef: \"\",\n\t\t\t\tdesc: i18n[\"starttime\"],\n\t\t\t},\n\t\t\tnative: {},\n\t\t\t_id: id,\n\t\t};\n\t\tif (id.endsWith(\"addEvent\")) {\n\t\t\tobj.common.write = true;\n\t\t\tobj.common.desc = i18n.createNewEvent;\n\t\t\tconst idTerms = id.split(\".\");\n\t\t\tif (this.events[idTerms[idTerms.length - 2]].useIQontrol) {\n\t\t\t\tobj.common.custom = {\n\t\t\t\t\t\"iqontrol.0\": {\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\tstatesAddInput: true,\n\t\t\t\t\t\tstatesAddInputCaption: i18n.dateOrPeriod,\n\t\t\t\t\t\tshowOnlyTargetValues: false,\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trole: \"text\",\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\t\t} else if (id.endsWith(\"data\")) {\n\t\t\tobj.common.desc = \"data as JSON\";\n\t\t\tobj.common.role = \"json\";\n\t\t}\n\t\tadapter.setObjectAsync(id, obj);\n\t}\n\n\tsyncIQontrolStates(): void {\n\t\tif (this.iQontrolTimerID) {\n\t\t\tclearTimeout(this.iQontrolTimerID);\n\t\t}\n\t\tadapter.log.debug(\"update addEvent-states\");\n\t\tconst iqontrolStates: Record<string, string> = {\n\t\t\t\"0\": i18n.today,\n\t\t\t\"1\": i18n.Tomorrow,\n\t\t};\n\t\tconst d = new Date().getDay();\n\t\tfor (let i = 2; i < 7; i++) {\n\t\t\tiqontrolStates[i.toString()] =\n\t\t\t\ti18n[\"weekDaysFull\" + new String((d + i) % 7)] + \" \" + i18n.inXDays.replace(\"%d\", i.toString());\n\t\t}\n\t\tfor (const id in this.events) {\n\t\t\tif (this.events[id].useIQontrol) {\n\t\t\t\tadapter.getObjectAsync(Event.namespace + id + \".addEvent\").then((eventObj) => {\n\t\t\t\t\tif (eventObj && eventObj.common.custom && eventObj.common.custom[\"iqontrol.0\"]) {\n\t\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\teventObj.common.custom[\"iqontrol.0\"][\"states\"] = iqontrolStates;\n\t\t\t\t\t\tadapter.setObject(eventObj._id, eventObj);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tconst midNight = new Date();\n\t\tmidNight.setDate(midNight.getDate() + 1);\n\t\tmidNight.setHours(0, 10, 0);\n\t\tthis.iQontrolTimerID = setTimeout(\n\t\t\tthis.syncIQontrolStates.bind(this),\n\t\t\tmidNight.getTime() - new Date().getTime(),\n\t\t);\n\t}\n\n\tsyncFlags(): void {\n\t\tfor (const evID in this.events) {\n\t\t\tthis.events[evID].syncFlags();\n\t\t}\n\t}\n\n\tresetAll(): void {\n\t\tif (this.iQontrolTimerID) {\n\t\t\tclearTimeout(this.iQontrolTimerID);\n\t\t}\n\t\tfor (const evID in this.events) {\n\t\t\tthis.events[evID].reset();\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": ["RegExpEscape", "dayjs", "_err"]
}
